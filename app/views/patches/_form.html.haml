= form_tag '/patches', method: :post, id: :new_patch do
  - if @patch.errors.any?
    #error_explanation
      %h2= "#{pluralize(@patch.errors.count, "error")} prohibited this patch from being saved:"
      %ul
        - @patch.errors.full_messages.each do |msg|
          %li= msg
  .container
    .stretchy
      .volca
        .small.knob.eg#attack
          .notch
        .small.knob.eg#decay_release
          .notch
        .small.knob.eg#cutoff_eg_int
          .notch
        #led
          .digit#thousands
          .digit#hundreds
          .digit#tens
          .digit#ones
        .medium.knob#peak
          .notch
        .large.knob#cutoff
          .notch
        .medium.knob.lfo#lfo_rate
          .notch
        .medium.knob.lfo#lfo_int
          .notch
        .small.knob.vco#vco1_pitch
          .notch
        .small.knob.vco#vco2_pitch
          .notch
        .small.knob.vco#vco3_pitch
          .notch
        .button#vco1_active
        .button#vco2_active
        .button#vco3_active
        .bottom-row
          = radio_button_tag 'patch[vco_group]', 'one', true, class: :control
          = label_tag('patch[vco_group_one]') do
            %span
              .light{ data: { radio: true} }
          = radio_button_tag 'patch[vco_group]', 'two', false, class: :control
          = label_tag('patch[vco_group_two]') do
            %span
              .light{ data: { radio: true} }
          = radio_button_tag 'patch[vco_group]', 'three', true, class: :control
          = label_tag('patch[vco_group_three]') do
            %span
              .light.lit{ data: { radio: true} }
          = check_box :patch, :lfo_target_amp, { class: :control, checked: (@patch.lfo_target_amp || false)}, 'true', 'false'
          = label_tag('patch[lfo_target_amp]') do
            %span
              .light
          = check_box :patch, :lfo_target_pitch, { class: :control, checked: (@patch.lfo_target_pitch || false)}, 'true', 'false'
          = label_tag('patch[lfo_target_pitch]') do
            %span
              .light
          = check_box :patch, :lfo_target_cutoff, { class: :control, checked: (@patch.lfo_target_cutoff || true)}, 'true', 'false'
          = label_tag('patch[lfo_target_cutoff]') do
            %span
              .light.lit
          = check_box :patch, :lfo_wave, { class: :control, checked: (@patch.lfo_wave || false)}, 'square', 'triangle'
          = label_tag('patch[lfo_wave]') do
            %span
              .light
          = check_box :patch, :vco1_wave, { class: :control, checked: (@patch.vco1_wave || false)}, 'square', 'saw'
          = label_tag('patch[vco1_wave]') do
            %span
              .light
          = check_box :patch, :vco2_wave, { class: :control, checked: (@patch.vco2_wave || false)}, 'square', 'saw'
          = label_tag('patch[vco2_wave]') do
            %span
              .light
          = check_box :patch, :vco3_wave, { class: :control, checked: (@patch.vco3_wave || true)}, 'square', 'saw'
          = label_tag('patch[vco3_wave]') do
            %span
              .light.lit
          = check_box :patch, :sustain_on, { class: :control, checked: (@patch.sustain_on || false)}, 'true', 'false'
          = label_tag('patch[sustain_on]') do
            %span
              .light
          = check_box :patch, :amp_eg_on, { class: :control, checked: (@patch.amp_eg_on || false)}, 'true', 'false'
          = label_tag('patch[amp_eg_on]') do
            %span
              .light

    = range_field_tag 'patch[attack]', (@patch.attack || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[decay_release]', (@patch.decay_release || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[cutoff_eg_int]', (@patch.cutoff_eg_int || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[peak]', (@patch.peak || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[cutoff]', (@patch.cutoff || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[lfo_rate]', (@patch.lfo_rate || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[lfo_int]', (@patch.lfo_int || 63), in: 0..127, class: :hidden
    = range_field_tag 'patch[vco1_pitch]', (@patch.vco1_pitch || 63), class: :hidden
    = check_box :patch, :vco1_active, { class: :hidden, checked: (@patch.vco1_active.to_s || true)}, 'true', 'false'
    = range_field_tag 'patch[vco2_pitch]', (@patch.vco2_pitch || 63), class: :hidden
    = check_box :patch, :vco2_active, { class: :hidden, checked: (@patch.vco2_active.to_s || true)}, 'true', 'false'
    = range_field_tag 'patch[vco3_pitch]', (@patch.vco3_pitch || 63), class: :hidden
    = check_box :patch, :vco3_active, { class: :hidden, checked: (@patch.vco3_active.to_s || true)}, 'true', 'false'

    .field
      = label_tag :name, 'Patch name'
      = text_field_tag 'patch[name]', @patch.name, class: 'form-control'
    .field
      = label_tag :privacy, 'Private?'
      %br
      = radio_button_tag 'patch[private?]', true, @patch.private?, class: 'radio-inline'
      = label_tag 'patch[private_true]', 'Public'
      = radio_button_tag 'patch[private?]', false, !@patch.private?, class: 'radio-inline'
      = label_tag 'patch[private_false]', 'Private'
    .field
      = label_tag 'patch[notes]', 'Notes'
      = text_area_tag 'patch[notes]', @patch.notes, size: '50x3', class: 'form-control'
    .actions
      = submit_tag 'Save'
