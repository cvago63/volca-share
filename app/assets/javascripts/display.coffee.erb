VS.Display = (element) ->

  Digit = (element) ->
    @element = element

    @setSprite = (character) ->
      if character != 'blank' and isNaN(character)
        $(@element).css 'background-image', 'url(<%= asset_path("symbols.jpg") %>)'
        $(@element).css 'background-size', '605%'
      else
        $(@element).css 'background-image', 'url(<%= asset_path("numbers.jpg") %>)'
        $(@element).css 'background-size', '1120%'
      return

    @calculateClockOffset = (value, place) ->
      mapping = {}
      midiString = '' + value
      digit = midiString[midiString.length - place]
      mapping =
        'dash': -0.5
        'c': 19
        'n': 38
        'o': 59
        'f': 79
        't': 99.7
        'blank': 99.2
      mapping[value] or parseInt(digit, 10) * 9.98
    return

  @element = element

  @pitchString = (val) ->
    value = @vcoPitchValues[val]
    return 'blank o f f'.split(' ') if value == 0
    thousands = 'blank'
    tensString = '' + Math.abs(value) / 100
    thousands = 'dash' if value < 0
    value = Math.abs(value)
    if value >= 100 and value < 1000
      ones = 'n'
      tens = tensString[0]
      hundreds = '0'
    else if value >= 1000
      ones = 'n'
      tens = ('' + value)[1]
      hundreds = ('' + value)[0]
    else if value < 100 and value >= 10
      ones = 'c'
      tens = ('' + value)[1]
      hundreds = ('' + value)[0]
    else if value < 10
      ones = 'c'
      tens = ('' + value)[0]
      hundreds = '0'
    [thousands, hundreds, tens, ones]

  @octaveString = (value) ->
    ones = undefined
    switch true
      when value < 22
        ones = '1'
      when value >= 22 and value < 44
        ones = '2'
      when value >= 44 and value < 66
        ones = '3'
      when value >= 66 and value < 88
        ones = '4'
      when value >= 88 and value < 110
        ones = '5'
      when value >= 110 and value <= 127
        ones = '6'
    ('o c t ' + ones).split(' ')

  @noteString = (value) ->
    ones = undefined
    thousands = 'o'
    hundreds = 'c'
    tens = 't'
    switch true
      when value < 9
        tens = 'dash'
        ones = '1'
      when value >= 9 and value < 21
        ones = '0'
      when value >= 21 and value < 33
        ones = '1'
      when value >= 33 and value < 45
        ones = '2'
      when value >= 45 and value < 57
        ones = '3'
      when value >= 57 and value < 69
        ones = '4'
      when value >= 69 and value < 81
        ones = '5'
      when value >= 81 and value < 93
        ones = '6'
      when value >= 93 and value < 105
        ones = '7'
      when value >= 105 and value < 117
        ones = '8'
      when value > 117
        ones = '9'
    [thousands, hundreds, tens, ones]

  @midiString = (value) ->
    thousands = 'blank'
    if value > 99
      hundreds = ('' + value)[0]
      tens = ('' + value)[1]
      ones = ('' + value)[2]
    else if value > 9
      hundreds = 'blank'
      tens = ('' + value)[0]
      ones = ('' + value)[1]
    else
      hundreds = 'blank'
      tens = 'blank'
      ones = '' + value
    [thousands, hundreds, tens, ones]

  @update = (value, displayStyle) ->
    displayString = @[displayStyle](value)
    digits = [@digit1, @digit2, @digit3, @digit4]

    flip = (digit, char) ->
      digit.setSprite(char)
      $(digit.element).css('background-position', digit.calculateClockOffset(char, 1) + '% 0')

    flip(digits[i], displayString[i]) for digit, i in digits
    return

  @digit1 = new Digit($('#thousands'))
  @digit2 = new Digit($('#hundreds'))
  @digit3 = new Digit($('#tens'))
  @digit4 = new Digit($('#ones'))
  @vcoPitchValues = [
    -1200,-1200,-1100,-1000,-900,-800,-700,-600,-500,-400,-300,-200,-100,-96,-92
    -88,-84,-80,-78,-76,-74,-72,-70,-68,-66,-64,-62,-60,-58,-56,-54,-52,-50,-48
    -46,-44,-42,-40,-38,-36,-34,-32,-30,-28,-26,-24,-22,-20,-18,-16,-14,-12,-10
    -8,-6,-4,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26
    28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76
    78,80,84,88,92,96,100,200,300,400,500,600,700,800,900,1000,1100,1200,1200
  ]
  return
