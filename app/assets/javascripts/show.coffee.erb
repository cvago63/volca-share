$ ->
  return if $('body.show').length == 0
  activeKnob = undefined
  display = VS.display
  limit = 140
  new VS.MidiOut
  sequences = VS.sequences

  sequences.init()

  loadAudioSample = ->
    element = $('.sample')
    return unless element.data('embed-code') != undefined
    element.html(element.data('embed-code'))
    return

  $('.knob').each ->
    my_knob = new VS.Knob(this)
    degree = my_knob.degreeForMidi($(this).data('midi'), limit)
    $(this).data 'rotation', degree
    my_knob.autoRotate(degree)
    return

  $('.light').each ->
    $(this).addClass('lit') if $(this).data('active')
    return

  $('.button').each ->
    return unless $(this).data('active')
    vco = $(this).attr('id').split('_')[0]
    vcoKnob = $('.knob#' + vco + '_pitch')
    $(this).addClass('lit')
    vcoKnob.addClass('lit')
    return

  loadAudioSample()
  $('.knob').mouseenter ->
    midi = $(this).data('midi')
    activeKnob = new VS.Knob(this)
    display.update(midi, activeKnob.isPitch, activeKnob.isOctave, false)
    return
  return
