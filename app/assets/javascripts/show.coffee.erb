$ ->
  return if $('body.show').length == 0
  activeKnob = undefined
  knob = undefined
  display = new (VolcaShare.Display)($('#led'))
  limit = 140
  new VolcaShare.MidiOut

  loadAudioSample = ->
    element = $('.sample')
    return unless element.data('embed-code') != undefined
    element.html(element.data('embed-code'))
    return

  $('.knob').each ->
    my_knob = new VolcaShare.Knob(this)
    degree = my_knob.degreeForMidi($(this).data('midi'), limit)
    $(this).data 'rotation', degree
    my_knob.autoRotate degree, '#' + $(this).attr('id')
    return

  $('.bottom-row label').each ->
    if $(this).find('span').find('div').data('active')
      $(this).find('span').find('div').addClass('lit')
    return

  $('.sequence-light').each ->
    $(this).addClass('lit') if $(this).data('active')
    return

  $('.step-note').each ->
    $(this).html(VolcaShare.midiNoteNumbers[parseInt($(this).data('note'))])
    return

  $('.button').each ->
    return unless $(this).data('active')
    vco = $(this).attr('id').split('_')[0]
    vcoKnob = $('.knob#' + vco + '_pitch')
    $(this).addClass('lit')
    vcoKnob.addClass('lit')
    return

  loadAudioSample()
  $('.knob').mouseenter ->
    midi = $(this).data('midi')
    activeKnob = new VolcaShare.Knob(this)
    display.update(midi, activeKnob.isPitch, activeKnob.isOctave, false)
    return
  return
